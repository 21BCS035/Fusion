<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hostel Inventory List</title>
</head>
<body>
    <h1>Select Hall</h1>
    <label for="hall_select">Choose a Hall:</label>
    <select id="hall_select">
        <option value="">Select a Hall</option>
        {% for hall in halls %}
            <option value="{{ hall.id }}" {% if hall.id == selectedHallId %} selected {% endif %}>
                {{ hall.hall_id }}
            </option>
        {% endfor %} 
    </select>


    <button onclick="navigateToInventory()">Go</button>

    <h1>Hostel Inventory List</h1>
    <table border="1">
        <thead>
            <tr>
                <th>Hall ID</th>
                <th>Inventory ID</th>
                <th>Inventory Name</th>
                <th>Cost</th>
                <th>Quantity</th>
                <th>Edit</th>
                <th>Delete</th>
            </tr>
        </thead>
        <tbody>
            {% for inventory in inventories %}
            <tr>
                <td>{{ inventory.hall_id }}</td>
                <td>{{ inventory.inventory_id }}</td>
                <td>{{ inventory.inventory_name }}</td>
                <td>{{ inventory.cost }}</td>
                <td>{{ inventory.quantity }}</td>
                <td><button onclick="editInventory('{{ inventory.inventory_id }}')">Edit</button></td> 
                <td><button onclick="deleteInventory('{{ inventory.inventory_id }}')">Delete</button></td>

            </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        function navigateToInventory() {
            var selectedHallId = document.getElementById("hall_select").value;
            if (selectedHallId) {
                localStorage.setItem("selectedHallId", selectedHallId);
                window.location.href = "/hostelmanagement/inventory/" + selectedHallId + "/";
            } else {
                alert("Please select a hall before proceeding.");
            }
        }

        function editInventory(inventoryId) {
            var selectedHallId = document.getElementById("hall_select").value;
            window.location.href = "/hostelmanagement/inventory/edit_inventory/" + inventoryId + "/";
        }

        function deleteInventory(inventoryId) {
            var selectedHallId = document.getElementById("hall_select").value;
            fetch("/hostelmanagement/inventory/" + inventoryId + "/delete/", {
                method: "DELETE",
            })
            .then(response => {
                if (response.ok) {
                    alert("Inventory deleted successfully");
                    window.location.reload(); // Refresh the page to reflect changes
                } else {
                    alert("Failed to delete inventory");
                }
            })
            .catch(error => {
                console.error("Error:", error);
                alert("An error occurred while deleting the inventory");
            });
        }

        // Set selected option in dropdown list on page load
        window.onload = function() {
            // Get the hall ID from the URL
            var pathSegments = window.location.pathname.split('/');
            var hallIdFromUrl = pathSegments[pathSegments.length - 2]; // Assuming the hall ID is the second-to-last segment
            // console.log("Hall ID from URL:", hallIdFromUrl);
            localStorage.setItem("selectedHallId", hallIdFromUrl);
            
            var selectedHallId = localStorage.getItem("selectedHallId");
            if (selectedHallId) {
                document.getElementById("hall_select").value = selectedHallId;
            }

        };
    </script>
</body>
</html>
